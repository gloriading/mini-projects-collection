<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Memory | Flip to Match Cards</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.10/css/all.css" integrity="sha384-+d0P83n9kaQMCwj8F4RJB66tzIwOKmrdb46+porD/OvrJ+37WqIM7UoBtwHO6Nlg" crossorigin="anonymous">
    <link rel="stylesheet" href="project-01.css">
  </head>
  <body>
    <nav>
      <a href="../index.html">Projects Home</a>
    </nav>
    <header>
      <h2>
        memory game
      </h2>
    </header>
    <main>
<!-- button       -->
      <div class="control">
        <button id="start">start</button>
        <div class="counter-display">
          <p># of moves: <span class="counter"> 0 </span></p>
        </div>
      </div>
<!-- row 1       -->
      <div class="row">

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">1</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">2</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">3</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">4</div>
          </div>
        </div>

      </div>
<!-- row 2       -->
      <div class="row">

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">1</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">3</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">2</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">4</div>
          </div>
        </div>

      </div>
<!-- row 3       -->
      <div class="row">

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">8</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">7</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">6</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">5</div>
          </div>
        </div>

      </div>
<!-- row 4       -->
      <div class="row">

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">7</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">8</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">5</div>
          </div>
        </div>

        <div class="container">
          <div class="card">
            <div class="front"></div>
            <div class="back">6</div>
          </div>
        </div>

      </div>

  </main>

  <script>


    let cardArr = ["star","moon","sun","dog","cat","bird","up","down","star","moon","sun","dog","cat","bird","up","down"];
    const cardContents = document.querySelectorAll('.back');
    const startBtn = document.getElementById('start');
    const cards = document.querySelectorAll('.card');
    const counterDisplay = document.querySelector('.counter');
    let openedCards = [];
    let counter = 0;

// when the game start
// 1- shuffle the cards
// 2- restore the cards (cover the cards)
    startBtn.addEventListener('click', gameStart);

    function shuffle(arr) {
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function cardsRestore(){
      cards.forEach(function(card){
        card.classList.remove('flipped');
        card.classList.remove('disabled');
        card.classList.remove('match');
      });
      openedCards =[];
      counter = 0;
      counterDisplay.innerHTML = counter;
    }

    function gameStart(){
      cardsRestore();
      setTimeout(function(){
        let newCardSet = shuffle(cardArr);
        for(let i=0; i< cardContents.length; i++){
          // update contents
          cardContents[i].innerHTML = newCardSet[i];
          // update id
          cardContents[i].parentElement.id = newCardSet[i];
        }
      },300);
    }


// Handle card flip

    // cards.forEach(card=>card.addEventListener('click', displayCard));

    cards.forEach(card=>card.addEventListener('click',function(e){
      displayCard(e.currentTarget);
      handleOpen(e.currentTarget);
    }));

    function displayCard(card){
      card.classList.toggle('flipped');
      card.classList.toggle('disabled');
    }

// Handle matched/ unmatched

  function handleOpen(card){
    openedCards.push(card);
    if( openedCards.length === 2 ){
      moveCount();
      if( openedCards[0].getAttribute("id") === openedCards[1].getAttribute("id")){
        console.log('matched');
        matched();
      }else {
        console.log('not matched');
        notMached();
      }
    }
  }

  function matched(){
    // add a border to it
    // prevent it from being clicked
    // clear openedCards array
    setTimeout(function(){
      openedCards[0].classList.add('match');
      openedCards[1].classList.add('match');
      openedCards = [];
    },500);
  }

  function notMached(){
    // all cards cannot be clicked
    cards.forEach(function(card){
      card.classList.add('disabled');
    });
    setTimeout(function(){
      // flip the not-matched cards back after 1 sec
      openedCards[0].classList.remove('flipped');
      openedCards[1].classList.remove('flipped');
      // clear openedCards array
      openedCards = [];
      // all cards can be clicked again
      cards.forEach(function(card){
        card.classList.remove('disabled');
      });
    },1000);

  }

  // keep track of number of moves
  function moveCount(){
    counter ++;
    // console.log(counter);
    counterDisplay.innerHTML = counter;
  }

  window.onload = gameStart();
  </script>

  </body>
</html>
